.. _getting-started:

***************
开始/新手入门
***************

.. _installing-on-win:

在Windows计算机上安装InVEST和样例数据==========================================================

从https://naturalcapitalproject.stanford.edu/software/invest下载InVEST安装程序。可执行文件名为“InVEST_<version >_Setup.exe”。双击这个.exe运行安装程序。

点击第一个屏幕并同意许可协议后，将出现“选择组件”屏幕。安装程序将始终安装InVEST工具和HTML和PDF版本的InVEST用户指南。还可以选择安装样例数据集，默认情况下它们都是选中的。请注意，这些数据集是通过互联网下载的，有些数据集非常大(特别是海洋数据集)，因此需要很长时间安装。如果您不希望安装全部或部分样例数据集，请取消选中相应的框。

接下来，选择将安装InVEST工具集和样例数据的文件夹。安装程序显示所选驱动器上有多少可用空间。单击Install开始安装。

安装完成后，InVEST安装文件夹将包含以下内容:


+ **documentation** 文件夹，包含HTML格式的InVEST用户指南。

+ **invest-3-x64** 文件夹，包含组成InVEST工具集的编译后的Python代码。

+ **InVEST_<version>_Documentation.pdf**，PDF格式的InVEST用户指南。

+ **Uninstall_<version>.exe**，卸载InVEST。

+ **HISTORY.rst**，每个新版本中包含的所有更新的列表。

+ 如果您选择安装样例数据，则它们将位于文件夹**sample_data**中，每个模型的数据都有一个子文件夹。



此外，所有InVEST独立应用程序快捷方式将添加到您的Windows开始菜单下 *所有程序->投InVEST |版本|*


高级安装
---------------------

InVEST 的windows安装程序为不同的使用情景提供了许多安装选项，包括静默安装和使用本地样例数据。要查看可用的选项，下载安装程序，打开CMD提示符到包含下载安装程序的目录，键入:


.. code-block:: text

    .\InVEST_<version>_x64_Setup.exe /?


.. _installing-on-mac:

在您的Mac上安装InVEST
=============================================

..注意::
    在Mac OS 10.13“High Sierra”中，需要InVEST 3.4.0或更高版本。

    在Mac OS 11“Big Sur”中，需要InVEST 3.9.0或更高版本。

    Mac二进制文件的数值结果可能与Windows二进制文件的结果略有不同(通常在1e-4以内)。因此，我们认为InVEST二进制文件是“不稳定的”，但它们仍然应该提供合理的结果。和往常一样，如果有些东西似乎不能正常工作，请在论坛上告诉我们:https://community.naturalcapitalproject.org/

从https://naturalcapitalproject.stanford.edu/software/invest下载InVEST光盘镜像文件。文件名为“InVEST-<version>.dmg”。这包含了一个InVEST可执行文件的副本。注意，在3.9.0版本中，用户指南和HISTORY.rst文件不再包含在Mac发行版中;请在线访问这些资源。

如何安装:

 1. 右键单击下载的“InVEST-<version>.dmg”，并在上下文菜单中选择*Open*。
 2. 在弹出的对话框中，再次单击*Open*。
 3. 磁盘映像将打开并指示您将InVEST应用程序拖到Applications文件夹。这一步对于InVEST能否正确工作至关重要。
 4. 转到Applications文件夹，从那里打开InVEST应用程序。
 5. 第一次打开InVEST应用程序时，您需要执行以下操作:
      1. 右键单击“InVEST”，在上下文菜单中选择“Open”。
      2. 在弹出的对话框中，再次单击*Open*。
 6. 在启动器对话框中，选择您想要运行的模型并单击*Launch*。

与Windows安装程序不同，Mac发行版不包括样例数据或用户指南。这些都可以在https://naturalcapitalproject.stanford.edu/software/invest上找到。


InVEST快速入门教程
===========================

本高级教程向您介绍了使用InVEST进行生态系统服务分析所涉及的主要活动。它不是一个详尽的分步技术文本，但确实提供了运行一个InVEST模型所需的步骤、技巧和所需时间的基本内容。虽然每个项目所需的时间差异很大，但每个步骤都提供了一个大致的估计时间:*低* =通常需要不到一天;*中* =不到一周;*高* =一周或更长时间。

1. **InVEST安装**
	-下载InVEST并安装，详见本章的:“installing-on-win”或“installation -on-mac”章节。
	-建议同时安装InVEST安装程序提供的样例数据。
	-InVEST安装时间:低
2. **阅读每个感兴趣的模型的用户指南章节**
	-对于每个模型，《用户指南》包含背景、方程、数据要求、结果描述以及对全球数据源和方法的建议。
	-这是描述关于模型和数据要求相关问题的第一处地方。
	-阅读模型章节所需时间:低
3. **检查模型的样本数据**
	-提供了所有模型的样例数据，可在InVEST安装期间安装，或可单独下载。
	-使用GIS软件查看空间数据，使用电子表格或文本编辑器查看表格数据。
	-使用这些数据来了解输入和输出，并运行模型。
	-将他们作为一个例子，学会如何调整自己的数据格式。
	-参见:“using-sample-data”章节了解更多信息。
	-使用样例数据测试模型所需时间:低
4. **创建自己的数据**
	-收集模型所需的空间和非空间模型输入数据。
	-处理您感兴趣的领域所收集的数据，使每个输入都符合InVEST要求。
	-大部分处理工作将使用GIS软件完成。
	-许多模型还需要对某些参数进行广泛的文献搜索。
	-参考模型的用户指南章节和样本数据，以了解数据集应该是什么样的需求和样例格式。
	-也可以参考本章的:“formatting-data”部分了解一般技巧。
	-处理的量会有很大的不同，这取决于特定的模型输入和数据原始的格式。
	-最好是寻找更多的本地数据源，但如果这些无法获得，一般可以获得更粗略的全局数据层和值。每个模型的用户指南附录提供了一些全局数据源的提示。
	-单个模型创建数据所需时间:高。
5. **创建未来情景**
	-分析情景是可选的，但通常是默认的。
	-情景通常基于变化的土地利用/土地覆盖、栖息地或土地管理图层，以反映一定干预措施或气候变化的影响。
	-例如，如果将利益相关者考虑进运算过程中，或者需要气候建模，创建情景可能非常耗时。
	-创建情景所需时间:中~高。
6. **运行模型**
	-使用InVEST用户界面或命令行脚本以您的数据运行模型。
	-更多信息请参见本章的:“running-models”部分。
	-所需时间:低到中等，取决于输入数据的大小和复杂性，以及正在运行的模型。高分辨率数据或大范围区域需要更多的时间。
7. **检查模型结果**
	-使用GIS软件严格检查结果，检查结果模式和值是否有意义?
	-无法解释的模式或异常的高或低值可能表明输入数据有问题。
	-时间要求:低到中。
8. **校准模型**
	-可选，对于高水平筛选分析或者是实地数据无法用于验证，则不一定是必需的。
	-但是，如果使用模型结果进行估值，则进行校准是很重要的。
	-收集和处理与感兴趣的InVEST模型输出相对应的观测数据。例如，水库进水口监测站的沉积物负荷。
	-调整模型输入，使模型结果与观测数据一致。
	-校准可能伴随着灵敏度分析，以确定哪些参数对结果影响最大。在校准调整中，最敏感的参数就是很好的选择。
	-所需时间:中~高。
9. **结合受益者**
	-将模型结果链接到人，或其他类型的受益人。这就是它成为生态系统“服务”的地方。
	-收集和预处理有关人员、基础设施或其他利益受益人位置的数据。
	-结合InVEST模型结果和受益人数据，通常使用GIS软件完成。
	-时间要求:中。
10. **估值**
	-生态系统服务的估值，无论是货币的还是非货币的，通常是复杂的和结合具体情况分析的。
	-收集与您正在分析的服务和受益人相关的经济数据。
	-在使用模型结果进行估值前校准它们。
	-所需时间:中~高。
11. **沟通结果**
	-一旦你有了InVEST的结果，你将创建地图，表格，图形等，这取决于你需要什么来向他人传达你的结果。
	-也可以对结果进行后期处理。例如，您可以在InVEST结果图上显示覆盖的保护区地图。或者将多个生态系统服务地图组合成一个最大组合服务提供的“热点”地图。或者在一个感兴趣的领域内聚合结果。
	-请记住，选择的颜色和符号要便于大众阅读，易于理解，并且能够准确地代表结果。
	-所需时间:根据项目需求的复杂程度，低至中。


GIS技巧
＝＝＝＝＝＝＝＝＝＝

**许多InVEST分析步骤需要中级地理信息系统(GIS)技能，特别是在创建模型输入和处理模型输出时**

本用户指南假定您具备所需的GIS技能，一般不提供有关使用GIS软件查看或处理数据的说明。您可以使用任何您熟悉的地理空间软件，其中QGIS和ArcGIS是最常见的。有许多课程和教程可用于学习GIS技能和软件，我们建议在开始使用InVEST之前先熟悉这些概念和工具。

下面是一些典型的InVEST分析部分的GIS任务类型的样例。当然这不是一个完整的列表:

+查看和浏览栅格、矢量和表格数据

+符号化栅格和矢量数据

+将数据层重新投影到一个公共坐标系统

+剪辑数据层到感兴趣的区域

+栅格与矢量之间的相互转换

+创建新的点，线或多边形矢量

+编辑矢量属性表

+执行栅格的各种数学运算

+重分类栅格值

+重采样栅格

另请参阅本章的“使用DEM数据”部分，其中提供了一些关于GIS处理数字高程模型(DEM)数据的详细信息，这些数据用于SDR、NDR、季节性水量、风景质量和海岸脆弱性模型。


独立的InVEST工具
=======================

所有InVEST模型都运行在一个完全开源的平台上，在这个平台上，以前的工具集是ArcGIS脚本的集合。新的界面不需要ArcGIS，结果可以使用任何GIS工具进行探索，包括“ArcGIS<https://www.esri.com/en-us/home>”、“QGIS <https://qgis.org/en/site/>”等。从InVEST2.3.0开始，工具集已经有了独立的模型版本，安装后可以从Windows开始菜单*所有程序->InVEST|version|*下获得。独立版本目前可用于所有型号。不再支持InVEST模型的ArcGIS版本。


旧的InVEST版本
=====================
InVEST的旧版本可以在http://data.naturalcapitalproject.org/invest-releases/deprecated_models.html上找到。请注意，许多模型由于关键的未解决的科学问题而被弃用，我们强烈建议您使用InVEST的最新版本。

．．_using-sample-data:

使用样例数据
=================

InVEST提供了样例数据作为数据格式的指南，并开始理解模型的工作方式。例如，在准备分析数据时，您可能希望通过更改样例数据中的输入值来测试模型，以查看输出如何响应。对于大多数模型，重要的是它们的样本数据仅用于测试和样例，不要使用空间数据或表格值进行自己的分析，因为它们的来源和准确性没有文档记录。一些海洋模型带有全局数据集，可用于您自己的应用程序-请参阅这些模型的个别用户指南章节以获取更多信息。

样例数据可以在InVEST安装文件夹中的单独子文件夹中找到。例如，授粉模型的样例数据集在InVEST安装文件夹中的“sample_data”文件夹里的“Pollination”文件夹，而碳模型的样例数据集在InVEST安装文件夹中的“sample_data”文件夹里的“Carbon”。为了测试模型，您可以在样本数据文件夹中创建一个名为“output”的文件夹作为工作区，用于保存模型结果。一旦开始处理自己的数据，就需要创建一个工作区和输入数据文件夹来保存自己的输入和结果。您还需要重新链接您的数据和工作空间以方便访问。

如果在Windows上运行，样例数据可能在安装InVEST的同时安装，或者数据集可以从InVEST网站<https://naturalcapitalproject.stanford.edu/software/invest>上单独下载。

．．_formatting-data:

整理数据格式
====================

在运行InVEST之前，有必要对数据进行一定格式的处理。虽然本指南的后续章节描述了如何为每个模型准备输入数据，但所有模型都有几个通用的数据格式指南:

+数据文件名不应该有空格(例如，一个栅格文件应该命名为“landuse”。而不是“land use.tif”)。

对于栅格数据，为了便于使用，首选tiff格式，但您也可以使用IMG或ESRI GRID。

+如果使用ESRI GRID格式的栅格，其数据集名称不能超过13个字符，并且第一个字符不能是数字。TIFF和IMG光栅没有文件名长度限制。当使用ESRI GRID作为模型接口的输入时，使用文件“hdr.adf”。

+空间数据必须在投影坐标系中(如UTM)，而不是地理坐标系(如WGS84)，并且给定模型运行的所有输入数据必须在相同的投影坐标系中。如果您的数据没有被预处理，InVEST将给出错误或不正确的结果。(也有例外，比如沿海脆弱性——具体要求请参见模型的用户指南章节。)

虽然InVEST 3.0模型现在非常节省内存，但运行模型所需的时间仍然受到输入数据集大小的影响。如果感兴趣的区域很大，或使用单元格较小的栅格（分辨率较高），这将增加内存使用和运行模型所需的时间。如果它们太大，就会发生内存错误。如果发生这种情况，请尝试减少感兴趣区域的大小，或使用分辨率较低的输入数据。

类似地，模型使用的磁盘空间量与输入数据的分辨率成比例。如果感兴趣的区域很大或使用小单元尺寸的栅格，这将增加中间存储和最终模型结果所需的磁盘空间量。如果没有足够的可用磁盘空间，模型将给出错误提示。

在另一个程序中打开输入数据文件运行模型可能会导致错误。确保数据文件没有被其他程序使用，以防止数据访问问题。

+区域和语言选项:一些语言设置有可能在运行模型时导致错误。例如，使用逗号(，)作为小数而不是句号(.)的设置会在模型中导致错误。要解决这个问题，请将计算机的区域设置更改为英文。

+当模型运行时，可能需要更改输入表中的值。这通常是用电子表格程序，如Excel或文本编辑器，如notepad++。输入表必须是CSV(逗号分隔值)格式，其中值由逗号分隔，而不是分号或任何其他字符。如果在Excel中工作，则无法看到分隔符，因此请在记事本或其他文本编辑器中再次检查。保存CSV文件时，请确保使用以下编码之一保存文件:ASCII、UTF-8或Signed UTF-8。使用任何其他编码(如Latin-1)将导致输出文件中的文本格式不正确，并可能导致模型运行失败。

+一些模型需要特定的数据文件命名指南(例如，栖息地质量模型)和字段(列)名称，这些在每个模型的用户指南章节中定义。仔细遵循这些规则以确保你的数据集是有效的，否则模型会给出一个错误提示。

+记住使用样例数据集作为数据格式的指南。

．．_running-models:

运行模型
＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝

当您根据相关模型章节中的说明准备好数据并安装了InVEST的最新版本时，您就可以运行InVEST模型了。

开始:

+检查您的输入数据。在GIS中查看空间数据，确保值看起来正确，没有应该填充的数据缺失区域，所有数据图层都在相同的投影坐标系统中，等等。在电子表格或文本编辑器中查看表数据，确保值看起来正确，列名正确，并且以CSV格式保存。

+启动您想要运行的模型，并将您的输入数据添加到用户界面中的每个数据栏内。您可以将图层拖放到数据栏中，或者单击每个数据栏右侧的文件图标来导入您的数据。

如果输入路径指向不存在的文件或格式不正确的文件，则在输入名称的左侧用红色“X”标记。如果你点击红色的X，它会告诉你数据有什么问题。如果有红色的X，模型将无法运行。

+注意，每个工具都有一个地方可以输入后缀，这是一个字符串，将被添加到输出文件名*<filename>_Suffix*。添加唯一的后缀可以防止覆盖以前迭代中生成的文件。如果您正在运行多个情景，这尤其有用，因为每个文件名都可以指示情景的名称。

+当所有必填项填写完毕，且没有红色的X时，点击界面上的**运行**按钮。

+处理时间将根据脚本和输入数据集的分辨率和范围而有所不同。每个模型都会打开一个窗口，显示脚本的进度。请确保观察输出窗口以查找有用的消息和错误。此进度信息也将被写入工作区中名为*<model name>-log-<timestamp>.txt*的文件中。如果遇到错误需要联系NatCap寻求帮助，请始终发送此日志文件，它将有助于调试。更多信息请参见本章的“support-and-error-reporting”部分。

模型的结果可以在**Workspace**文件夹中找到。主要输出通常位于Workspace文件夹的顶层。还有一个“中间”文件夹，其中包含一些在进行计算时生成的附加文件。虽然通常不需要查看中间结果，但在调试问题或试图更好地理解模型的工作方式时，查看中间结果有时是有用的。阅读模型章节并查看相应的中间文件是理解和评价结果的好方法。本用户指南中的每个模型章节都提供了这些输出文件的描述。

在您的脚本成功完成之后，您可以通过将它们从Workspace添加到GIS来查看空间结果。仔细地、批判性地审视结果是很重要的。这些价值有意义吗?这些结果有意义吗?你明白为什么有些地方的价值较高，而有些地方的价值较低吗?您的输入层和参数是如何影响结果的?

．．_support-and-error-reporting:

支持和错误报告
===========================

如果您在运行模型时遇到任何问题，或者对其理论、数据或应用有任何用户指南未涵盖的问题，请访问用户支持论坛https://community.naturalcapitalproject.org/。首先，请使用**搜索**功能查看是否已经有人问过类似的问题。很多时候，你的问题已经得到了解答。如果你没有找到与你的问题相关的现有帖子，或者它们不能解决你的问题，你可以登录并创建一个新帖子。

如果您在运行模型时报告错误，请在论坛帖子中包含以下信息:

+你所咨询的InVEST模型

+你正在使用的InVEST版本

+你已经试图解决这个问题，但没有起作用

+由模型产生的整个日志文件，位于输出文件夹*<model name>-log-<timestamp>.txt*

培训
--------

根据经费和需求，每年可举办若干次关于InVEST的培训班。有关这些培训的信息将在支持页面上公布，可以在“自然资本项目网站<https://naturalcapitalproject.stanford.edu/>”上找到。该网站也是关于InVEST、相关出版物和使用案例以及自然资本项目其他活动很好的信息来源。

免费的大规模在线开放课程(MOOC)网站：“英语版<https://www.edx.org/course/introduction-to-the-natural-capital-project-approach/>”和“西班牙语版<https://www.edx.org/course/una-introduccion-al-enfoque-de-capital-natural-ver-2/>”，将提供:

-介绍自然资本项目相关方法

-InVEST简介

-详细介绍了SDR、海岸脆弱性和城市降温模型

-其他生态系统服务分析主题概述，包括情景、受益者和数据来源

-若干案例研究。



还有一个“YouTube播放列表<https://www.youtube.com/playlist?list= plsfk2ilv3ufnqrzgwfcgyyozzzqzdnj2v7/>与视频培训教程，包括:

-夏季系列: InVEST简介(简要介绍InVEST，SDR，海岸脆弱性和沟通结果)

-夏季系列:水体质量(NDR和SDR更详细地介绍)

-夏季系列:城市InVEST(更详细地介绍了城市降温)

-介绍:牧场生产

-简介:生境质量

-介绍:固碳

-介绍:季节产水量

-导论:城市洪涝调蓄

.. _working-with-the-DEM:

使用DEM数据
====================

对于水体模型SDR、NDR和季节性产水量，拥有一个精心准备的数字高程模型(DEM)是至关重要的。它必须没有缺失的数据(NoData值的孔隙)，并且应该正确地表示感兴趣区域的地表水流模式，以便获得准确的结果。

使用最高质量、最佳分辨率的DEM，将减少出现下沉和丢失数据的可能性，并将更准确地表示地形的表面水流，提供所需的详细信息，以便在您感兴趣的范围内做出明智的决策。

虽然每个DEM来源都是不同的，每个研究区域的范围和每个项目的要求也是不同的，但我们通常需要几个步骤来准备一个在InVEST模型中运行的DEM。下面列出了每一个步骤，包括使用ArcGIS和QGIS的相关信息。DEM处理还有其他应用，包括ArcHydro、ArcSWAT、AGWA和BASINS，这里没有介绍这些应用。这只是对DEM编制中涉及的问题和方法的简要概述，而不是GIS教程。

1.**RAW格式的马赛克数据转化为DEM数据**

  如果您已经下载了多个相邻瓦片中的区域的DEM数据，则需要首先将它们拼接在一起以创建单个DEM栅格。在ArcToolbox中，使用Data Management Tools -> Raster -> Raster Dataset -> Mosaic to New Raster。仔细查看输出栅格，以确保瓦片连接边缘的值是正确的。如果不是，请在“马赛克到新栅格”工具中尝试不同的“马赛克方法”参数值。

  在QGIS中，您可以使用Raster -> Miscellaneous -> Merge功能来拼接瓦片。

2.**重新投影到项目的坐标系**

  在ArcGIS (Project Raster工具)或QGIS (Warp工具)中重新投影DEM时，对于ArcGIS中的“重采样技术”或QGIS中的“重采样方法”，重要的是选择BILINEAR或CUBIC。选择NEAREST(或QGIS中的Near)将在感兴趣的区域生成一个格网模式不正确的DEM，这可能只在放大或运行Flow Direction后才会明显。这将创建一个糟糕的流网络和流模式，并导致糟糕的模型结果。

3.**检查丢失的数据**

  仔细查看DEM栅格，以确保在感兴趣的区域内没有缺失的数据，这些数据由NoData单元格表示。如果存在NoData单元格，则必须为它们分配值。

  对于孔隙，一种方法是使用栅格计算器中的ArcGIS Focal Mean函数(或Conditional -> CON)。例如，在ArcGIS 10.X中输入::

	Con(IsNull("theDEM"),FocalStatistics("theDEM",NbrRectangle(3,3),"MEAN"),"theDEM")

  插值也可以使用，并且可以更好地工作于较大的孔。使用转换工具将DEM转化为点 Conversion Tools -> From Raster -> Raster to Point，使用Spatial Analyst's Interpolation tools进行插值，然后使用CON将插值后的值分配给原始DEM:

       Con(isnull([theDEM])， [interpolated_grid]， [theDEM])

  在QGIS中，尝试Fill Nodata tool，或者the GRASS r.neighbors tool。其中r.neighbors提供了不同的统计类型，包括Mean等。

4.** DEM填洼**

  这一步几乎总是必需的。

  来自ESRI关于“洼地如何工作”的帮助:“洼地是一个像元或一组空间连接的像元，其流向不能被分配到流向栅格中的八个有效值之一。当所有相邻的像元都高于处理像元时，或者当两个像元相互流入，形成一个双像元循环时，就会发生这种情况。”

  洼地通常是由DEM中的错误引起的，它们可以产生不正确的流向栅格。这可能会导致水文处理的几个问题，包括创建一个不连续的流网络。填洼会为异常像元分配新的值，这样它们就能更好地与相邻的栅格衔接。但是这个过程可能会产生新的洼地，所以可能需要一个迭代的过程。

  我们发现QGIS Wang and Liu填充工具在填洼方面做得很好，推荐使用(即使是ArcGIS用户)。你也可以通过使用Hydrology -> Fill tool.来使用ArcGIS。可能需要多次运行Fill tool。

5.**验证流网络**

  此时，DEM应该可以进行测试了。最主要的是查看流的生成情况，所以你需要一个现实世界中的流图与之进行比较，这可以是具有地理空间属性的，也可以不是，只要你能直观地进行比较。

  由DEM模型生成的流网络应该与已知现实世界中正确的流图上的流紧密匹配。一些InVEST水文模型和支持的InVEST工具RouteDEM输出一个流网络(通常称为*stream.tif*)。这些工具通过首先生成流量方向和流量积累栅格来创建流(您应该检查此步骤)，然后用输入的“阈值流量积累”(TFA)值来选择应该成为流网络一部分的像素。例如，如果给定的TFA值为1000，那么在将1000个像素视为流的一部分之前，必须将其转移到特定的像素中。这相当于说流是由流量累积值>= 1000的部分来定义的。

  使用这些*stream.tif*输出用于评估建模产生的流与现实的匹配程度，并相应地调整阈值流量累积。TFA值越大，河网越粗，支流越少，TFA值越小，支流越多。TFA没有一个“正确”的值，每个您感兴趣的领域和DEM都是不同的。对于测试来说，一个很好的初始值是1000。当比较*stream.tif*与现实世界的流时，检查您有适当的支流粗细，并确保*stream.tif*的流是连续的，而不是分割成不连接的片段或单个像素。请注意，建模的流很少(如果有的话)与现实完全相同，所以您的目标不是完美，而是让它们合理地接近。如果建模的流是不连续的，尝试在DEM上做另一次填充，并确保您使用BILINEAR或者CUBIC工具进行重投影。如果无论你怎么尝试，DEM都不能产生连续的流，那么我们建议尝试另一种高程数据。有几种全球可用的高程数据，当然它们在世界上不同的地方表现不同。

  要创建流量累积和流图，而不需要运行整个水文模型，您可以使用InVEST工具RouteDEM，该工具专门用于处理DEM。更多信息请参见:“RouteDEM page < RouteDEM >”。

6.* *创建流域* *

  建议从您将在分析中使用的DEM中创建流域。如果从其他地方获得流域，则流域的边界可能与您用于建模的DEM创建的水文数据无法对齐，从而导致不正确的聚合结果。

 有各种各样的工具可以创建流域，包括ArcGIS Watershed tool、QGIS Watershed basins或者r.basins.fill.InVEST还提供了一个名为DelineateIt的工具，效果很好，使用简单，推荐使用。它的优点是能够创造重叠的流域，例如当同一条河上有几个大坝时。更多信息请参见:“delimateit page < delimateit >”。

  生成流域后，验证它们是否正确地表示集水区，并且每个流域在字段“ws_id”(或“subws_id”，取决于模型-请参阅您正在使用的水文模型的数据需求部分，根据您的需要而定)中分配了唯一的ID。

7.** 按照您的研究区域裁剪DEM**

  我们通常建议将DEM裁剪到比您感兴趣的区域略大的区域(通常是流域)。这是为了确保捕捉流域边缘周围的水文情况。如果DEM(或其他模型输入数据)低分辨率的，这一点尤其重要，因为对流域多边形的裁剪将导致边缘周围大面积的数据缺失。为此，在流域多边形周围创建一个缓冲区，并将DEM裁剪到该缓冲多边形。确保缓冲区的宽度至少与最粗糙模型输入栅格数据的单元格大小相同。例如，如果您的降水数据是最粗糙的，分辨率为1km，则在流域多边形周围创建一个宽度至少为1km的缓冲区，并使用该缓冲的流域来剪辑所有模型输入，包括DEM。然后使用未缓冲的流域作为模型的输入。


